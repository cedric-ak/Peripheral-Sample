/*
 * File:   SSD1308_OLED.c
 * Author: CEDRIC
 *
 * Created on 05 April 2020, 4:37 PM
 */

#include "mcc_generated_files/mcc.h"

void SSD1306_Init(void) {

    SSD1306_RESET_SetHigh();
    __delay_ms(10);
    SSD1306_RESET_SetLow();
    __delay_ms(10);
    SSD1306_RESET_SetHigh();

    SSD1306_writeCMD(SSD1306_DISPLAYOFF, SSD1306_DISPLAYOFF); //0xAE Display OFF
#ifdef SSD1306_128_64
    SSD1306_writeCMD(SSD1306_SETMULTIPLEX, 63); //0xA8 Set MUX Ratio to 64
#endif
#ifdef SSD1306_128_32
    SSD1306_writeCMD(SSD1306_SETMULTIPLEX, 0x1F); //0xA8 Set MUX Ratio to 32
#endif

    SSD1306_writeCMD(SSD1306_SETDISPLAYOFFSET, 0x0); //0xD3 Set Display Offset start at 0
    SSD1306_writeCMD(SSD1306_CHARGEPUMP,SSD1306_CHARGEPUMP);
    SSD1306_writeCMD(SSD1306_MEMORYMODE, 0x00); //0x20 memory addressing horizontal mode
    SSD1306_writeCMD(SSD1306_SETDISPLAYSTARTLINE, SSD1306_SETDISPLAYSTARTLINE); //0x40 Set Display Start Line to 0
    SSD1306_writeCMD(SSD1306_SEGREMAP_ADD_7F, SSD1306_SEGREMAP_ADD_7F); //0xA0 Set Segment re-map A0h
    SSD1306_writeCMD(SSD1306_COMSCANDEC, SSD1306_COMSCANDEC); //0xC8 Set COM Output Scan Direction Normal (0xC4 for mirror images)

#ifdef SSD1306_128_64
    SSD1306_writeCMD(SSD1306_SETCOMPINS, 0x12); //0xDA Sequential COM pin configuration, Disable COM Left/Right remap*(0X2)
    SSD1306_writeCMD(SSD1306_SETCONTRAST, 0x7F); //0x81 set display contrast 7F,8F
#endif
#ifdef SSD1306_128_32
    SSD1306_writeCMD(SSD1306_SETCOMPINS, 0x2); //0xDA Sequential COM pin configuration, Disable COM Left/Right remap
    SSD1306_writeCMD(SSD1306_SETCONTRAST, 0x8F); //set display contrast 
#endif

#ifdef SSD1306_96_16
    SSD1306_writeCMD(SSD1306_SETCOMPINS, 0x2); //0x12                       //0xDA Sequential COM pin configuration, Disable COM Left/Right remap
    SSD1306_writeCMD(SSD1306_SETCONTRAST, 0xAF); //set display contrast(0x10 for external vcc 
#endif
    SSD1306_writeCMD(SSD1306_SETPRECHARGE, SSD1306_SETPRECHARGE); //set precharge period
    SSD1306_writeCMD(SSD1306_SETVCOMDETECT, 0x40); //0xDB
    SSD1306_writeCMD(SSD1306_DISPLAYALLON_RESUME, SSD1306_DISPLAYALLON_RESUME); //0xA4 Normal display mode
    SSD1306_writeCMD(SSD1306_NORMALDISPLAY, SSD1306_NORMALDISPLAY); //0xA6 Normal display OFF in display panel *
    SSD1306_writeCMD(SSD1306_SETDISPLAYCLOCKDIV, 0x80); //0xD5 Set osc Frequency
    SSD1306_writeCMD(SSD1306_CHARGEPUMP, 0x14); //0x8D Enable charge pump regulator
    SSD1306_writeCMD(SSD1306_DEACTIVATE_SCROLL, SSD1306_DEACTIVATE_SCROLL); //0x2E deactivate scroll
    SSD1306_writeCMD(SSD1306_DISPLAYON, SSD1306_DISPLAYON); //0xAF Display ON
}

/**********************************************************
 **Name:     SSD1306 write command
 **Function: Is used or called when writing commands to the display
 **Input:    control byte register
 **Output:   none
 **Note:     none
 **********************************************************/
void SSD1306_writeCMD(uint8_t controlReg, uint8_t dataByte) {
    I2C_start();
    I2C_Write(SSD1306_ADDRESS);
    I2C_Write(controlReg);
    dataByte == SSD1306_REG_NODATA ? I2C_stop() : I2C_Write(dataByte);
    I2C_stop();
}

void SSD1306_writeData(uint8_t data) {
    uint8_t Control = 0x00;
    I2C_start();
    I2C_Write(SSD1306_ADDRESS);
    I2C_Write(Control);
    I2C_Write(data);
    I2C_stop();
}
#define ssd1306_swap(a, b) { int16_t t = a; a = b; b = t; }
// the memory buffer for the LCD
static uint8_t Buffer[SSD1306_LCDHEIGHT * SSD1306_LCDWIDTH / 8] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
    0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x80, 0x80, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xF0, 0xF8, 0xFC, 0xF8, 0xE0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0xFF,
#if (SSD1306_LCDHEIGHT * SSD1306_LCDWIDTH > 96*16)
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00,
    0x80, 0xFF, 0xFF, 0x80, 0x80, 0x00, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x8C, 0x8E, 0x84, 0x00, 0x00, 0x80, 0xF8,
    0xF8, 0xF8, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0xE0, 0xC0, 0x80,
    0x00, 0xE0, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF, 0xC7, 0x01, 0x01,
    0x01, 0x01, 0x83, 0xFF, 0xFF, 0x00, 0x00, 0x7C, 0xFE, 0xC7, 0x01, 0x01, 0x01, 0x01, 0x83, 0xFF,
    0xFF, 0xFF, 0x00, 0x38, 0xFE, 0xC7, 0x83, 0x01, 0x01, 0x01, 0x83, 0xC7, 0xFF, 0xFF, 0x00, 0x00,
    0x01, 0xFF, 0xFF, 0x01, 0x01, 0x00, 0xFF, 0xFF, 0x07, 0x01, 0x01, 0x01, 0x00, 0x00, 0x7F, 0xFF,
    0x80, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x7F, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x01, 0xFF,
    0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x0F, 0x3F, 0x7F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE7, 0xC7, 0xC7, 0x8F,
    0x8F, 0x9F, 0xBF, 0xFF, 0xFF, 0xC3, 0xC0, 0xF0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0xFC, 0xFC,
    0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xF8, 0xF8, 0xF0, 0xF0, 0xE0, 0xC0, 0x00, 0x01, 0x03, 0x03, 0x03,
    0x03, 0x03, 0x01, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x01, 0x01,
    0x03, 0x01, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x01, 0x01, 0x03, 0x03, 0x00, 0x00,
    0x00, 0x03, 0x03, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x01, 0x03, 0x01, 0x00, 0x00, 0x00, 0x03,
    0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
#if (SSD1306_LCDHEIGHT == 64)
    0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xF0, 0xF9, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F, 0x1F, 0x0F,
    0x87, 0xC7, 0xF7, 0xFF, 0xFF, 0x1F, 0x1F, 0x3D, 0xFC, 0xF8, 0xF8, 0xF8, 0xF8, 0x7C, 0x7D, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x3F, 0x0F, 0x07, 0x00, 0x30, 0x30, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xFE, 0xFE, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xC0, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xC0, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x7F, 0x3F, 0x1F,
    0x0F, 0x07, 0x1F, 0x7F, 0xFF, 0xFF, 0xF8, 0xF8, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xE0,
    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFE, 0x00, 0x00,
    0x00, 0xFC, 0xFE, 0xFC, 0x0C, 0x06, 0x06, 0x0E, 0xFC, 0xF8, 0x00, 0x00, 0xF0, 0xF8, 0x1C, 0x0E,
    0x06, 0x06, 0x06, 0x0C, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0xFE, 0xFE, 0x00, 0x00, 0x00, 0x00, 0xFC,
    0xFE, 0xFC, 0x00, 0x18, 0x3C, 0x7E, 0x66, 0xE6, 0xCE, 0x84, 0x00, 0x00, 0x06, 0xFF, 0xFF, 0x06,
    0x06, 0xFC, 0xFE, 0xFC, 0x0C, 0x06, 0x06, 0x06, 0x00, 0x00, 0xFE, 0xFE, 0x00, 0x00, 0xC0, 0xF8,
    0xFC, 0x4E, 0x46, 0x46, 0x46, 0x4E, 0x7C, 0x78, 0x40, 0x18, 0x3C, 0x76, 0xE6, 0xCE, 0xCC, 0x80,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x0F, 0x1F, 0x1F, 0x3F, 0x3F, 0x3F, 0x3F, 0x1F, 0x0F, 0x03,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x00, 0x00,
    0x00, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x00, 0x00, 0x03, 0x07, 0x0E, 0x0C,
    0x18, 0x18, 0x0C, 0x06, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x01, 0x0F, 0x0E, 0x0C, 0x18, 0x0C, 0x0F,
    0x07, 0x01, 0x00, 0x04, 0x0E, 0x0C, 0x18, 0x0C, 0x0F, 0x07, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x00,
    0x00, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x07,
    0x07, 0x0C, 0x0C, 0x18, 0x1C, 0x0C, 0x06, 0x06, 0x00, 0x04, 0x0E, 0x0C, 0x18, 0x0C, 0x0F, 0x07,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#endif
#endif
};

const char Font[] = {
    0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x5F, 0x00, 0x00,
    0x00, 0x07, 0x00, 0x07, 0x00,
    0x14, 0x7F, 0x14, 0x7F, 0x14,
    0x24, 0x2A, 0x7F, 0x2A, 0x12,
    0x23, 0x13, 0x08, 0x64, 0x62,
    0x36, 0x49, 0x56, 0x20, 0x50,
    0x00, 0x08, 0x07, 0x03, 0x00,
    0x00, 0x1C, 0x22, 0x41, 0x00,
    0x00, 0x41, 0x22, 0x1C, 0x00,
    0x2A, 0x1C, 0x7F, 0x1C, 0x2A,
    0x08, 0x08, 0x3E, 0x08, 0x08,
    0x00, 0x80, 0x70, 0x30, 0x00,
    0x08, 0x08, 0x08, 0x08, 0x08,
    0x00, 0x00, 0x60, 0x60, 0x00,
    0x20, 0x10, 0x08, 0x04, 0x02,
    0x3E, 0x51, 0x49, 0x45, 0x3E,
    0x00, 0x42, 0x7F, 0x40, 0x00,
    0x72, 0x49, 0x49, 0x49, 0x46,
    0x21, 0x41, 0x49, 0x4D, 0x33,
    0x18, 0x14, 0x12, 0x7F, 0x10,
    0x27, 0x45, 0x45, 0x45, 0x39,
    0x3C, 0x4A, 0x49, 0x49, 0x31,
    0x41, 0x21, 0x11, 0x09, 0x07,
    0x36, 0x49, 0x49, 0x49, 0x36,
    0x46, 0x49, 0x49, 0x29, 0x1E,
    0x00, 0x00, 0x14, 0x00, 0x00,
    0x00, 0x40, 0x34, 0x00, 0x00,
    0x00, 0x08, 0x14, 0x22, 0x41,
    0x14, 0x14, 0x14, 0x14, 0x14,
    0x00, 0x41, 0x22, 0x14, 0x08,
    0x02, 0x01, 0x59, 0x09, 0x06,
    0x3E, 0x41, 0x5D, 0x59, 0x4E,
    0x7C, 0x12, 0x11, 0x12, 0x7C,
    0x7F, 0x49, 0x49, 0x49, 0x36,
    0x3E, 0x41, 0x41, 0x41, 0x22,
    0x7F, 0x41, 0x41, 0x41, 0x3E,
    0x7F, 0x49, 0x49, 0x49, 0x41,
    0x7F, 0x09, 0x09, 0x09, 0x01,
    0x3E, 0x41, 0x41, 0x51, 0x73,
    0x7F, 0x08, 0x08, 0x08, 0x7F,
    0x00, 0x41, 0x7F, 0x41, 0x00,
    0x20, 0x40, 0x41, 0x3F, 0x01,
    0x7F, 0x08, 0x14, 0x22, 0x41,
    0x7F, 0x40, 0x40, 0x40, 0x40,
    0x7F, 0x02, 0x1C, 0x02, 0x7F,
    0x7F, 0x04, 0x08, 0x10, 0x7F,
    0x3E, 0x41, 0x41, 0x41, 0x3E,
    0x7F, 0x09, 0x09, 0x09, 0x06,
    0x3E, 0x41, 0x51, 0x21, 0x5E,
    0x7F, 0x09, 0x19, 0x29, 0x46,
    0x26, 0x49, 0x49, 0x49, 0x32,
    0x03, 0x01, 0x7F, 0x01, 0x03,
    0x3F, 0x40, 0x40, 0x40, 0x3F,
    0x1F, 0x20, 0x40, 0x20, 0x1F,
    0x3F, 0x40, 0x38, 0x40, 0x3F,
    0x63, 0x14, 0x08, 0x14, 0x63,
    0x03, 0x04, 0x78, 0x04, 0x03,
    0x61, 0x59, 0x49, 0x4D, 0x43,
    0x00, 0x7F, 0x41, 0x41, 0x41,
    0x02, 0x04, 0x08, 0x10, 0x20,
    0x00, 0x41, 0x41, 0x41, 0x7F,
    0x04, 0x02, 0x01, 0x02, 0x04,
    0x40, 0x40, 0x40, 0x40, 0x40,
    0x00, 0x03, 0x07, 0x08, 0x00,
    0x20, 0x54, 0x54, 0x78, 0x40,
    0x7F, 0x28, 0x44, 0x44, 0x38,
    0x38, 0x44, 0x44, 0x44, 0x28,
    0x38, 0x44, 0x44, 0x28, 0x7F,
    0x38, 0x54, 0x54, 0x54, 0x18,
    0x00, 0x08, 0x7E, 0x09, 0x02,
    0x18, 0xA4, 0xA4, 0x9C, 0x78,
    0x7F, 0x08, 0x04, 0x04, 0x78,
    0x00, 0x44, 0x7D, 0x40, 0x00,
    0x20, 0x40, 0x40, 0x3D, 0x00,
    0x7F, 0x10, 0x28, 0x44, 0x00,
    0x00, 0x41, 0x7F, 0x40, 0x00,
    0x7C, 0x04, 0x78, 0x04, 0x78,
    0x7C, 0x08, 0x04, 0x04, 0x78,
    0x38, 0x44, 0x44, 0x44, 0x38,
    0xFC, 0x18, 0x24, 0x24, 0x18,
    0x18, 0x24, 0x24, 0x18, 0xFC,
    0x7C, 0x08, 0x04, 0x04, 0x08,
    0x48, 0x54, 0x54, 0x54, 0x24,
    0x04, 0x04, 0x3F, 0x44, 0x24,
    0x3C, 0x40, 0x40, 0x20, 0x7C,
    0x1C, 0x20, 0x40, 0x20, 0x1C,
    0x3C, 0x40, 0x30, 0x40, 0x3C,
    0x44, 0x28, 0x10, 0x28, 0x44,
    0x4C, 0x90, 0x90, 0x90, 0x7C,
    0x44, 0x64, 0x54, 0x4C, 0x44,
    0x00, 0x08, 0x36, 0x41, 0x00,
    0x00, 0x00, 0x77, 0x00, 0x00,
    0x00, 0x41, 0x36, 0x08, 0x00,
    0x02, 0x01, 0x02, 0x04, 0x02
  
};

// startscrollright
// Activate a right handed scroll for rows start through stop
// Hint, the display is 16 rows tall. To scroll the whole display, run:
// display.scrollright(0x00, 0x0F)
void SSD1306_TextSize(uint8_t t_size)
{
  if(t_size < 1)
    t_size = 1;
  text_size = t_size;
} 

void SSD1306_startscrollright(uint8_t start, uint8_t stop) {
    SSD1306_writeCMD(SSD1306_RIGHT_HORIZONTAL_SCROLL, 0x00);
    SSD1306_writeData(start);
    SSD1306_writeData(0x00);
    SSD1306_writeData(stop);
    SSD1306_writeData(0x00);
    SSD1306_writeData(0xFF);
    SSD1306_writeCMD(SSD1306_ACTIVATE_SCROLL, SSD1306_ACTIVATE_SCROLL);
}

// startscrollleft
// Activate a right handed scroll for rows start through stop
// Hint, the display is 16 rows tall. To scroll the whole display, run:
// display.scrollright(0x00, 0x0F)

void SSD1306_startscrollLeft(uint8_t start, uint8_t stop) {
    SSD1306_writeCMD(SSD1306_LEFT_HORIZONTAL_SCROLL, 0x00);
    SSD1306_writeData(start);
    SSD1306_writeData(0x00);
    SSD1306_writeData(stop);
    SSD1306_writeData(0x00);
    SSD1306_writeData(0xFF);
    SSD1306_writeCMD(SSD1306_ACTIVATE_SCROLL, SSD1306_ACTIVATE_SCROLL);
}

// startscrolldiagright
// Activate a diagonal scroll for rows start through stop
// Hint, the display is 16 rows tall. To scroll the whole display, run:
// display.scrollright(0x00, 0x0F)

void SSD1306_startscrolldiagright(uint8_t start, uint8_t stop) {
    SSD1306_writeCMD(SSD1306_SET_VERTICAL_SCROLL_AREA, 0x00);
    SSD1306_writeCMD(SSD1306_LCDHEIGHT, SSD1306_LCDHEIGHT);
    SSD1306_writeCMD(SSD1306_VERTICAL_AND_RIGHT_HORIZONTAL_SCROLL, 0x00);
    SSD1306_writeData(start);
    SSD1306_writeData(0x00);
    SSD1306_writeData(stop);
    SSD1306_writeData(0x01);
    SSD1306_writeCMD(SSD1306_ACTIVATE_SCROLL, SSD1306_ACTIVATE_SCROLL);
}

void SSD1306_stopscroll(void) {
    SSD1306_writeCMD(SSD1306_DEACTIVATE_SCROLL, SSD1306_DEACTIVATE_SCROLL);
}

void SSD1306_dim(bool status) {
    uint8_t contrast;
    if (status) {
        contrast = 0; // display  
    } else {
        //       contrast = 0x9F;  //for external VCC
        contrast = 0xCF;
    }
    // the range of contrast to too small to be really useful
    // it is useful to dim the display
    SSD1306_writeCMD(SSD1306_SETCONTRAST, SSD1306_SETCONTRAST);
    SSD1306_writeData(contrast);
}

void SSD1306_setTextWrap(uint8_t w) {
    wrap = w & 1;
}

void SSD1306_invertDisplay(uint8_t i) {
    if (i & 1) {
        SSD1306_writeCMD(SSD1306_INVERTDISPLAY, SSD1306_INVERTDISPLAY);
        return;
    }
    SSD1306_writeCMD(SSD1306_NORMALDISPLAY, SSD1306_NORMALDISPLAY);
}

void SSD1306_setCursor(uint8_t x, uint8_t y) {
    if ((x > SSD1306_LCDWIDTH / 6) || y > SSD1306_LCDHEIGHT / 8)
        return;
    x_pos = x;
    y_pos = y;
}

void SSD1306_PutC(char c) {
    uint8_t i, font_c;
    if ((c < ' ') || (c > '~'))
        c = '?';
    SSD1306_writeCMD(SSD1306_COLUMNADDR,SSD1306_COLUMNADDR);
            SSD1306_writeData(6 * (x_pos - 1));
    SSD1306_writeData(6 * (x_pos - 1) + 4); // Column end address (127 = reset)

    SSD1306_writeCMD(SSD1306_PAGEADDR,SSD1306_PAGEADDR);
    SSD1306_writeData(y_pos - 1); // Page start address (0 = reset)
    SSD1306_writeData(y_pos - 1); // Page end address

    I2C_start();
    I2C_Write(SSD1306_ADDRESS);
    I2C_Write(0x40);

    for (i = 0; i < 5; i++) {
        font_c = Font[(c - 32) * 5 + i];

        I2C_Write(font_c);
    }
    I2C_stop();

#if defined SSD1306_128_64 || defined SSD1306_128_32
    x_pos = x_pos % 21 + 1;
    if (wrap && (x_pos == 1))
#if defined SSD1306_128_64
        y_pos = y_pos % 8 + 1;
#else
        y_pos = y_pos % 4 + 1;
#endif

#else
    x_pos = x_pos % 16 + 1;
    if (wrap && (x_pos == 1))
        y_pos = y_pos % 2 + 1;
#endif
}

void SSD1306_Print(char *s) {
    uint8_t i = 0;
    while (s[i] != '\0') {
        if (s[i] == ' ' & x_pos == 1)
            i++;
        else
            SSD1306_PutC(s[i++]);
    }
}

void SSD1306_clearDisplay(void) {
    uint16_t i;
    SSD1306_writeCMD(SSD1306_COLUMNADDR, SSD1306_COLUMNADDR);
    SSD1306_writeData(0);
#if defined SSD1306_128_64 || defined SSD1306_128_32
    SSD1306_writeData(127); // Column end address
#else
    ssd1306_command(95); // Column end address
#endif

    SSD1306_writeCMD(SSD1306_PAGEADDR, SSD1306_PAGEADDR);
            SSD1306_writeData(0); // Page start address (0 = reset) 
#if defined SSD1306_128_64
    SSD1306_writeData(7); // Page end address
#elif defined SSD1306_128_32
    ssd1306_command(3); // Page end address
#elif defined SSD1306_96_16
    ssd1306_command(1); // Page end address
#endif

    I2C_start();
    I2C_Write(SSD1306_ADDRESS);
    I2C_Write(0x40);

    for (i = 0; i < SSD1306_LCDHEIGHT * SSD1306_LCDWIDTH / 8; i++) {
        I2C_Write(0);
    }
    I2C_stop();
}


